<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Hugo 0.35" />


<title>map_df() - A Hugo website</title>
<meta property="og:title" content="map_df() - A Hugo website">



  







<link rel="stylesheet" href="/css/fonts.css" media="all">
<link rel="stylesheet" href="/css/main.css" media="all">



  </head>
  <body>
    <div class="wrapper">
      <header class="header">
        <nav class="nav">
  <a href="/" class="nav-logo">
    <img src="/images/logo.png"
         width="50"
         height="50"
         alt="Logo">
  </a>

  <ul class="nav-links">
    
    <li><a href="/about/">About</a></li>
    
    <li><a href="https://github.com/rstudio/blogdown">GitHub</a></li>
    
    <li><a href="https://twitter.com/rstudio">Twitter</a></li>
    
  </ul>
</nav>

      </header>


<main class="content" role="main">

  <article class="article">
    
    <span class="article-duration">2 min read</span>
    

    <h1 class="article-title">map_df()</h1>

    
    <span class="article-date">2016/05/30</span>
    

    <div class="article-content">
      

<p>I&rsquo;m using <a href="https://twitter.com/hadleywickham?lang=en-gb">Hadley</a>&rsquo;s <a href="https://cran.r-project.org/web/packages/purrr/purrr.pdf">purrr</a> package more and more, and its beginning to change the way I program in R, much like <a href="https://cran.rstudio.com/web/packages/dplyr/vignettes/introduction.html">dplyr</a> did.</p>

<p><code>map()</code> is a great function and one of its incarnations that I really like is <code>map_df()</code>.This will apply a function to elements of a list, and then bind the dataframes together (assuming they can be combined).
It also allows us to specify additional columns for our final dataframe which takes the names of the elements of the list.</p>

<p>Here&rsquo;s a simple example:</p>

<p>{% highlight r %}
library(dplyr)
library(purrr)
library(ggplot2)</p>

<h1 id="see-accumulate-for-my-inspiration-for-this-example">See ?accumulate for my inspiration for this example</h1>

<p>rerun(6, rnorm(100)) %&gt;%
  map_df(
    ~ data_frame(x = .x),
    .id = &ldquo;dist&rdquo;
  ) %&gt;%
  ggplot +
  aes(
    x = x,
    fill = dist
  ) +
  geom_histogram() +
  facet_wrap(
    ~dist,
    ncol = 2
  )
{% endhighlight %}</p>

<p><img src="/figures/2016-05-30-hist-facet-1.svg" alt="plot of chunk 2016-05-30-hist-facet" /></p>

<h3 id="so-what-s-going-on-here">So what&rsquo;s going on here?</h3>

<ul>
<li>First I create a list of six univariate normal distributions using <code>rnorm()</code>.<br /></li>
<li>Passing this to <code>map_df()</code> with the function (<code>.f</code>) argument as  <code>data_frame(x = .x)</code> will convert each of these vectors of variables into a dataframe, naming the column of variables as <code>x</code>.<br /></li>
<li><code>map_df()</code> essentially does a <code>bind_rows()</code> and outputs a single dataframe, adding a new variable <code>dist</code> which takes the names of the elements of the list, outputting a long dataframe.<br /></li>
<li>Finally this is passed to <code>ggplot()</code> which creates histograms with <code>geom_histogram()</code>, and facets them into six panes with <code>facet_wrap()</code>.<br /></li>
</ul>

<p>{% highlight r %}
map_df
{% endhighlight %}</p>

<p>{% highlight text %}</p>

<h2 id="function-x-f-id-null">function (.x, .f, &hellip;, .id = NULL)</h2>

<h2 id="toc_3">{</h2>

<h2 id="f-as-function-f">.f &lt;- as_function(.f, &hellip;)</h2>

<h2 id="res-map-x-f">res &lt;- map(.x, .f, &hellip;)</h2>

<h2 id="dplyr-bind-rows-res-id-id">dplyr::bind_rows(res, .id = .id)</h2>

<h2 id="toc_7">}</h2>

<h2 id="environment-namespace-purrr"><environment: namespace:purrr></h2>

<p>{% endhighlight %}</p>

<p>It&rsquo;s a very simply function, but nonetheless very useful.
This is a fairly contrived example, but I find myself using these <code>map()</code> functions a lot recently - especially when training models, and working with lists or dataframes full of dataframes.</p>

<p>{% highlight r %}
sessionInfo()
{% endhighlight %}</p>

<p>{% highlight text %}</p>

<h2 id="r-version-3-3-0-2016-05-03">R version 3.3.0 (2016-05-03)</h2>

<h2 id="platform-x86-64-pc-linux-gnu-64-bit">Platform: x86_64-pc-linux-gnu (64-bit)</h2>

<h2 id="running-under-ubuntu-14-04-4-lts">Running under: Ubuntu 14.04.4 LTS</h2>

<h2 id="locale">locale:</h2>

<h2 id="1-lc-ctype-en-gb-utf-8-lc-numeric-c">[1] LC_CTYPE=en_GB.UTF-8       LC_NUMERIC=C</h2>

<h2 id="3-lc-time-en-gb-utf-8-lc-collate-en-gb-utf-8">[3] LC_TIME=en_GB.UTF-8        LC_COLLATE=en_GB.UTF-8</h2>

<h2 id="5-lc-monetary-en-gb-utf-8-lc-messages-en-gb-utf-8">[5] LC_MONETARY=en_GB.UTF-8    LC_MESSAGES=en_GB.UTF-8</h2>

<h2 id="7-lc-paper-en-gb-utf-8-lc-name-c">[7] LC_PAPER=en_GB.UTF-8       LC_NAME=C</h2>

<h2 id="9-lc-address-c-lc-telephone-c">[9] LC_ADDRESS=C               LC_TELEPHONE=C</h2>

<h2 id="11-lc-measurement-en-gb-utf-8-lc-identification-c">[11] LC_MEASUREMENT=en_GB.UTF-8 LC_IDENTIFICATION=C</h2>

<h2 id="attached-base-packages">attached base packages:</h2>

<h2 id="1-stats-graphics-grdevices-utils-datasets-base">[1] stats     graphics  grDevices utils     datasets  base</h2>

<h2 id="other-attached-packages">other attached packages:</h2>

<h2 id="1-ggplot2-2-1-0-purrr-0-2-1-dplyr-0-4-3-testthat-0-8-1">[1] ggplot2_2.1.0  purrr_0.2.1    dplyr_0.4.3    testthat_0.8.1</h2>

<h2 id="5-knitr-1-13">[5] knitr_1.13</h2>

<h2 id="loaded-via-a-namespace-and-not-attached">loaded via a namespace (and not attached):</h2>

<h2 id="1-rcpp-0-12-5-digest-0-6-4-assertthat-0-1-plyr-1-8-3">[1] Rcpp_0.12.5      digest_0.6.4     assertthat_0.1   plyr_1.8.3</h2>

<h2 id="5-grid-3-3-0-r6-2-1-2-gtable-0-2-0-dbi-0-4-1">[5] grid_3.3.0       R6_2.1.2         gtable_0.2.0     DBI_0.4-1</h2>

<h2 id="9-formatr-1-4-magrittr-1-5-scales-0-4-0-evaluate-0-9">[9] formatR_1.4      magrittr_1.5     scales_0.4.0     evaluate_0.9</h2>

<h2 id="13-lazyeval-0-1-10-labeling-0-3-tools-3-3-0-stringr-0-6-2">[13] lazyeval_0.1.10  labeling_0.3     tools_3.3.0      stringr_0.6.2</h2>

<h2 id="17-munsell-0-4-3-parallel-3-3-0-colorspace-1-2-6-methods-3-3-0">[17] munsell_0.4.3    parallel_3.3.0   colorspace_1.2-6 methods_3.3.0</h2>

<p>{% endhighlight %}</p>

    </div>
  </article>

  


</main>

      <footer class="footer">
        <ul class="footer-links">
          <li>
            <a href="/index.xml" type="application/rss+xml" target="_blank">RSS feed</a>
          </li>
          <li>
            <a href="https://gohugo.io/" class="footer-links-kudos">Made with <img src="/images/hugo-logo.png" width="22" height="22"></a>
          </li>
        </ul>
      </footer>

    </div>
    

    

    
  </body>
</html>

